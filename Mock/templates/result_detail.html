{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Imtihon natijasi</h2>
        <p class="text-xl text-gray-600 mb-6">{{ attempt.exam.title }}</p>

        <div class="flex flex-col md:flex-row justify-between items-center bg-gray-50 p-6 rounded-lg mb-8">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fas fa-chart-line text-5xl text-blue-500 mr-4"></i>
                <div>
                    <p class="text-sm text-gray-500">Ball</p>
                    <p class="text-4xl font-bold text-gray-800">{{ attempt.score|floatformat:0 }}%</p>
                </div>
            </div>
            <div class="text-center md:mx-4 mb-4 md:mb-0">
                <p class="text-sm text-gray-500">To'g'ri javoblar</p>
                <p class="text-3xl font-bold text-green-500">{{ attempt.correct_answers }}</p>
            </div>
            <div class="text-center">
                <p class="text-sm text-gray-500">Noto'g'ri javoblar</p>
                <p class="text-3xl font-bold text-red-500">{{ incorrect_answers_count }}</p>
            </div>
        </div>

        <h3 class="text-2xl font-bold text-gray-800 mb-4">Javoblar tahlili</h3>
        <div class="space-y-6">
            {% for user_answer in user_answers %}
            <div class="p-4 rounded-md border {% if user_answer.selected_option.is_correct %}border-green-300 bg-green-50{% else %}border-red-300 bg-red-50{% endif %}">
                <div class="flex justify-between items-center mb-2">
                    <p class="font-bold text-lg text-gray-800">Savol {{ forloop.counter }}:</p>
                    <i class="fas {% if user_answer.selected_option.is_correct %}fa-check-circle text-green-500{% else %}fa-times-circle text-red-500{% endif %} text-2xl"></i>
                </div>
                <p class="text-gray-700 mb-2">{{ user_answer.question.text }}</p>
                <ul class="space-y-1 mt-4">
                    {% for option in user_answer.question.answeroption_set.all %}
                    <li class="p-2 rounded-md {% if option.is_correct %}bg-green-200{% elif option == user_answer.selected_option %}bg-red-200{% endif %}">
                        <span class="{% if option == user_answer.selected_option %}font-bold{% endif %}">
                            {% if option == user_answer.selected_option %}
                                <i class="fas fa-chevron-right mr-2"></i>
                            {% endif %}
                            {{ option.text }}
                        </span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% empty %}
            <p class="text-gray-500">Javoblar topilmadi.</p>
            {% endfor %}
        </div>

        <div class="flex justify-end mt-8">
            <a href="{% url 'student_results' %}" class="px-6 py-2 bg-blue-500 hover:bg-blue-700 text-white font-bold rounded-md transition duration-300">
                Barcha natijalarni ko'rish
            </a>
        </div>
    </div>
</div>
{% endblock %}
